{"version":3,"file":"lib_index_js.be7727ec53f52cd4c79b.js","mappings":";;;;;;;;;AAAa;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,4BAA4B;AAC5B,4BAA4B;AAC5B,0BAA0B;AAC1B,gCAAgC;AAChC,gCAAgC;AAChC,8BAA8B;AAC9B,mBAAmB,mBAAO,CAAC,kFAAsB;AACjD,iBAAiB,mBAAO,CAAC,iCAAU;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,UAAU;AAC/C,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,WAAW;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iFAAiF;AACjF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACzRa;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,qBAAqB;AACrB,mBAAmB,mBAAO,CAAC,kFAAsB;AACjD,mBAAmB,mBAAO,CAAC,kFAAsB;AACjD,iBAAiB,mBAAO,CAAC,iCAAU;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA;AACA,sDAAsD,KAAK;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC5Ea;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,mBAAmB,mBAAO,CAAC,kFAAsB;AACjD,qBAAqB,mBAAO,CAAC,sFAAwB;AACrD,qBAAqB,mBAAO,CAAC,sFAAwB;AACrD,mBAAmB,mBAAO,CAAC,kFAAsB;AACjD,0BAA0B,mBAAO,CAAC,gGAA6B;AAC/D,qBAAqB,mBAAO,CAAC,sFAAwB;AACrD,mBAAmB,mBAAO,CAAC,kFAAsB;AACjD,qBAAqB,mBAAO,CAAC,sFAAwB;AACrD,sBAAsB,mBAAO,CAAC,wFAAyB;AACvD,mBAAmB,mBAAO,CAAC,kFAAsB;AACjD,sBAAsB,mBAAO,CAAC,wFAAyB;AACvD,wBAAwB,mBAAO,CAAC,4FAA2B;AAC3D,qBAAqB,mBAAO,CAAC,8EAAoB;AACjD,kBAAkB,mBAAO,CAAC,wEAAiB;AAC3C,oBAAoB,mBAAO,CAAC,4EAAmB;AAC/C,0BAA0B,mBAAO,CAAC,wFAAiB;AACnD,iBAAiB,mBAAO,CAAC,iCAAU;AACnC,mBAAmB,mBAAO,CAAC,qCAAY;AACvC,mBAAmB,mBAAO,CAAC,qCAAY;AACvC,kBAAkB,mBAAO,CAAC,mCAAW;AACrC,gBAAgB,mBAAO,CAAC,+BAAS;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,wCAAwC;AACxD;AACA,wDAAwD,wBAAwB;AAChF;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,kDAAkD,wBAAwB;AAC1E;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yDAAyD,OAAO;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA,qBAAqB;AACrB;AACA;AACA,qBAAqB;AACrB;AACA;AACA,qBAAqB;AACrB;AACA;AACA,qBAAqB;AACrB,iBAAiB;AACjB;AACA;AACA;AACA,4BAA4B,iBAAiB;AAC7C;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA,oBAAoB,iBAAiB;AACrC;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA,oBAAoB,iBAAiB;AACrC;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA,oBAAoB,iBAAiB;AACrC;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,qDAAqD,aAAa;AAClE,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qEAAqE,OAAO;AAC5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,iBAAiB;AAC7C;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,gCAAgC,kBAAkB;AAClD,qBAAqB;AACrB;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,mDAAmD;AAC3F;AACA;AACA;AACA;AACA,+KAA+K;AAC/K,iCAAiC;AACjC,6BAA6B;AAC7B;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA,kBAAe;;;;;;;;;;;AChYF;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,yBAAyB;AACzB,wBAAwB,mBAAO,CAAC,4FAA2B;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,uBAAuB;AAC5D;AACA,iBAAiB;AACjB,aAAa;AACb;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;;;;;;;;;;AC3Ca;AACb;AACA,6CAA6C;AAC7C;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,qCAAqC,GAAG,wBAAwB,GAAG,mDAAmD,GAAG,mCAAmC,GAAG,4CAA4C,GAAG,uBAAuB,GAAG,oBAAoB,GAAG,kBAAkB,GAAG,UAAU,GAAG,kBAAkB,GAAG,gDAAgD,GAAG,eAAe,GAAG,6BAA6B;AACxZ,mBAAmB,mBAAO,CAAC,kFAAsB;AACjD,wBAAwB,mBAAO,CAAC,4FAA2B;AAC3D,mCAAmC,mBAAO,CAAC,uDAAyB;AACpE;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA,gDAAgD;AAChD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA,6BAA6B,WAAW;AACxC,8BAA8B,WAAW;AACzC,wBAAwB,WAAW;AACnC,gCAAgC,WAAW;AAC3C,CAAC,iBAAiB,kBAAkB,kBAAkB;AACtD;AACA;AACA;AACA,oBAAoB;AACpB,aAAa,WAAW;AACxB;AACA,CAAC;AACD;AACA;AACA;AACA,uBAAuB;AACvB;AACA;AACA;AACA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD;AACnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB;AACxB;AACA;AACA,CAAC;AACD;AACA;AACA,CAAC;AACD;AACA;AACA;AACA,qCAAqC;AACrC;AACA,CAAC;;;;;;;;;;;AC7VY;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,6BAA6B;AAC7B,mCAAmC;AACnC,8CAA8C;AAC9C,mBAAmB,mBAAO,CAAC,kFAAsB;AACjD,wBAAwB,mBAAO,CAAC,4FAA2B;AAC3D,oBAAoB,mBAAO,CAAC,oFAAuB;AACnD,iBAAiB,mBAAO,CAAC,6DAAQ;AACjC,iBAAiB,mBAAO,CAAC,iCAAU;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,sCAAsC;AACzE;AACA,0EAA0E;AAC1E;AACA;AACA,mBAAmB,aAAa,SAAS,8CAA8C;AACvF;AACA;AACA;AACA;AACA;AACA;AACA,uFAAuF,OAAO,EAAE,MAAM;AACtG;AACA,0BAA0B,YAAY;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,YAAY,QAAQ,eAAe;AACxD;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,qBAAqB,YAAY,QAAQ,eAAe;AACxD;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,qBAAqB,YAAY,QAAQ,eAAe;AACxD;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,aAAa;AAC9D,qDAAqD,aAAa;AAClE;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gDAAgD,UAAU,GAAG,WAAW;AACxE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mEAAmE,sCAAsC,GAAG,WAAW;AACvH,wEAAwE,4CAA4C,OAAO,sBAAsB;AACjJ,mEAAmE,uCAAuC,OAAO,iBAAiB;AAClI,yEAAyE,6CAA6C,IAAI,uBAAuB;AACjJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,sBAAsB,gCAAgC;AACtD,SAAS;AACT;AACA;AACA;AACA;AACA,6BAA6B","sources":["webpack://jupyterlab-jupytext/./lib/commands.js","webpack://jupyterlab-jupytext/./lib/factory.js","webpack://jupyterlab-jupytext/./lib/index.js","webpack://jupyterlab-jupytext/./lib/registry.js","webpack://jupyterlab-jupytext/./lib/tokens.js","webpack://jupyterlab-jupytext/./lib/utils.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.isPairCommandToggled = isPairCommandToggled;\nexports.isPairCommandEnabled = isPairCommandEnabled;\nexports.executePairCommand = executePairCommand;\nexports.isMetadataCommandToggled = isMetadataCommandToggled;\nexports.isMetadataCommandEnabled = isMetadataCommandEnabled;\nexports.executeMetadataCommand = executeMetadataCommand;\nconst apputils_1 = require(\"@jupyterlab/apputils\");\nconst tokens_1 = require(\"./tokens\");\n/**\n * Get Jupytext format of current widget if it is a text notebook\n */\nfunction getWidgetJupytextFormats(notebookTracker) {\n    const model = notebookTracker.currentWidget.context.model;\n    const jupytext = model.getMetadata('jupytext');\n    if (!jupytext) {\n        return [];\n    }\n    const formats = jupytext.formats\n        ? jupytext.formats.split(',')\n        : [];\n    return formats.filter((format) => {\n        return format !== '';\n    });\n}\n/**\n * Get file extension of current notebook widget\n */\nfunction getNotebookFileExtension(notebookTracker) {\n    let notebookFileExtension = notebookTracker.currentWidget.context.path.split('.').pop();\n    if (!notebookFileExtension) {\n        return '';\n    }\n    notebookFileExtension = tokens_1.LANGUAGE_INDEPENDENT_NOTEBOOK_EXTENSIONS.includes(notebookFileExtension)\n        ? notebookFileExtension\n        : 'auto';\n    return notebookFileExtension;\n}\n/**\n * Get a list of all selected formats\n */\nfunction getSelectedFormats(notebookTracker) {\n    var _a;\n    if (!notebookTracker.currentWidget) {\n        return [];\n    }\n    let formats = getWidgetJupytextFormats(notebookTracker);\n    const model = notebookTracker.currentWidget.context.model;\n    const languageInfo = model.getMetadata('language_info');\n    if (languageInfo && languageInfo.file_extension) {\n        const scriptExt = languageInfo.file_extension.substring(1);\n        formats = formats.map((format) => {\n            // By default use percent format\n            if (format === scriptExt) {\n                return 'auto:percent';\n            }\n            // Replace language specific extension with auto\n            return format.replace(`${scriptExt}:`, 'auto:');\n        });\n    }\n    const notebookFileExtension = getNotebookFileExtension(notebookTracker);\n    if (!notebookFileExtension) {\n        return formats;\n    }\n    // Remove variant after : in format\n    const formatExtensions = formats.map((format) => {\n        return format.split(':')[0];\n    });\n    // If current notebook file extension in formats, return\n    if (formatExtensions.includes(notebookFileExtension)) {\n        return formats;\n    }\n    // When notebook loads for the first time, ipynb extension would not be\n    // in the formats. Here we add it and return formats\n    if (tokens_1.LANGUAGE_INDEPENDENT_NOTEBOOK_EXTENSIONS.includes(notebookFileExtension)) {\n        formats.push(notebookFileExtension);\n    }\n    else {\n        const model = notebookTracker.currentWidget.context.model;\n        const jupytext = model.getMetadata('jupytext');\n        const formatName = jupytext\n            ? ((_a = jupytext === null || jupytext === void 0 ? void 0 : jupytext.text_representation) === null || _a === void 0 ? void 0 : _a.formatName) || 'percent'\n            : 'percent';\n        formats.push(`auto:${formatName}`);\n    }\n    return formats;\n}\n/**\n * Toggle pair command\n */\nfunction isPairCommandToggled(format, notebookTracker) {\n    if (!notebookTracker.currentWidget) {\n        return false;\n    }\n    // Get selected formats on current widget\n    const selectedFormats = getSelectedFormats(notebookTracker);\n    if (format === 'custom') {\n        for (const selectedFormat of selectedFormats) {\n            if (!tokens_1.JUPYTEXT_FORMATS.includes(selectedFormat)) {\n                return true;\n            }\n        }\n        return false;\n    }\n    return selectedFormats.includes(format);\n}\n/**\n * Enable pair command\n */\nfunction isPairCommandEnabled(format, notebookTracker) {\n    if (!notebookTracker.currentWidget) {\n        return false;\n    }\n    const notebookFileExtension = notebookTracker.currentWidget.context.path.split('.').pop();\n    if (format === notebookFileExtension) {\n        return false;\n    }\n    // Get selected formats on current widget\n    const selectedFormats = getSelectedFormats(notebookTracker);\n    if (format === 'none') {\n        return selectedFormats.length > 1;\n    }\n    return true;\n}\n/**\n * Execute pair command\n */\nfunction executePairCommand(command, format, notebookTracker, trans) {\n    if (!notebookTracker.currentWidget) {\n        return;\n    }\n    const model = notebookTracker.currentWidget.context.model;\n    let jupytext = model.getMetadata('jupytext');\n    // Get selected formats on current widget\n    let selectedFormats = getSelectedFormats(notebookTracker);\n    // Toggle the selected format\n    console.debug('Jupytext: executing command=' + command);\n    if (format === 'custom') {\n        (0, apputils_1.showErrorMessage)(trans.__('Error'), trans.__('Please edit the notebook metadata directly if you wish a custom configuration.'));\n        return;\n    }\n    // Get current notebook widget extension\n    const notebookFileExtension = getNotebookFileExtension(notebookTracker);\n    // Toggle the selected format\n    const index = selectedFormats.indexOf(format);\n    if (format === 'none') {\n        // Only keep one format - one that matches the current extension\n        for (const selectedFormat of selectedFormats) {\n            if (selectedFormat.split(':')[0] === notebookFileExtension) {\n                selectedFormats = [selectedFormat];\n                break;\n            }\n        }\n    }\n    else if (index !== -1) {\n        selectedFormats.splice(index, 1);\n        // The current file extension can't be unpaired\n        let extFound = false;\n        for (const selectedFormat of selectedFormats) {\n            if (selectedFormat.split(':')[0] === notebookFileExtension) {\n                extFound = true;\n                break;\n            }\n        }\n        if (!extFound) {\n            return;\n        }\n    }\n    else {\n        // We can't have the same extension multiple times\n        const newFormats = [];\n        for (const selectedFormat of selectedFormats) {\n            if (selectedFormat.split(':')[0] !== format.split(':')[0]) {\n                newFormats.push(selectedFormat);\n            }\n        }\n        selectedFormats = newFormats;\n        selectedFormats.push(format);\n    }\n    if (selectedFormats.length === 1) {\n        if (notebookFileExtension !== 'auto') {\n            selectedFormats = [];\n        }\n        else if (jupytext === null || jupytext === void 0 ? void 0 : jupytext.text_representation) {\n            jupytext.text_representation.formatName =\n                selectedFormats[0].split(':')[1];\n            selectedFormats = [];\n        }\n    }\n    if (selectedFormats.length === 0) {\n        // an older version was re-fetching the jupytext metadata here\n        // but this is not necessary, as the metadata is already available\n        if (!jupytext) {\n            return;\n        }\n        if (jupytext.formats) {\n            delete jupytext.formats;\n        }\n        if (Object.keys(jupytext).length === 0) {\n            model.deleteMetadata('jupytext');\n        }\n        model.setMetadata('jupytext', jupytext);\n        return;\n    }\n    // set the desired format\n    if (jupytext) {\n        jupytext.formats = selectedFormats.join();\n    }\n    else {\n        jupytext = { formats: selectedFormats.join() };\n    }\n    model.setMetadata('jupytext', jupytext);\n}\n/**\n * Toggle metadata command\n */\nfunction isMetadataCommandToggled(notebookTracker) {\n    if (!notebookTracker.currentWidget) {\n        return false;\n    }\n    const model = notebookTracker.currentWidget.context.model;\n    const jupytextMetadata = model.getMetadata('jupytext');\n    if (!jupytextMetadata) {\n        return false;\n    }\n    const jupytext = jupytextMetadata;\n    if (jupytext.notebook_metadata_filter === '-all') {\n        return false;\n    }\n    return true;\n}\n/**\n * Enable metadata command\n */\nfunction isMetadataCommandEnabled(notebookTracker) {\n    if (!notebookTracker.currentWidget) {\n        return false;\n    }\n    const model = notebookTracker.currentWidget.context.model;\n    const jupytextMetadata = model.getMetadata('jupytext');\n    if (!jupytextMetadata) {\n        return false;\n    }\n    const jupytext = jupytextMetadata;\n    if (jupytext.notebook_metadata_filter === undefined) {\n        return true;\n    }\n    if (jupytext.notebook_metadata_filter === '-all') {\n        return true;\n    }\n    return false;\n}\n/**\n * Execute metadata command\n */\nfunction executeMetadataCommand(notebookTracker) {\n    var _a;\n    console.debug('Jupytext: toggling YAML header');\n    if (!notebookTracker.currentWidget) {\n        return;\n    }\n    const model = notebookTracker.currentWidget.context.model;\n    const jupytextMetadata = model.getMetadata('jupytext');\n    if (!jupytextMetadata) {\n        return;\n    }\n    const jupytext = ((_a = jupytextMetadata) !== null && _a !== void 0 ? _a : {});\n    if (jupytext.notebook_metadata_filter) {\n        delete jupytext.notebook_metadata_filter;\n        if (jupytext.notebook_metadata_filter === '-all') {\n            delete jupytext.notebook_metadata_filter;\n        }\n    }\n    else {\n        jupytext.notebook_metadata_filter = '-all';\n        if (jupytext.notebook_metadata_filter === undefined) {\n            jupytext.notebook_metadata_filter = '-all';\n        }\n    }\n    model.setMetadata('jupytext', jupytext);\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createFactory = createFactory;\nconst apputils_1 = require(\"@jupyterlab/apputils\");\nconst notebook_1 = require(\"@jupyterlab/notebook\");\nconst tokens_1 = require(\"./tokens\");\nfunction createFactory(kernelFileTypeNames, toolbarRegistry, settingRegistry, docRegistry, notebookTracker, notebookFactory, contentFactory, editorServices, rendermime, translator, trans, riseFactory) {\n    var _a, _b, _c;\n    const allFileTypes = tokens_1.FILE_TYPES.concat(kernelFileTypeNames);\n    // primarily this block is copied/pasted from jlab4 code and specifically\n    // jupyterlab/packages/notebook-extension/src/index.ts\n    // inside the function `activateWidgetFactory` at line 1150 as of this writing\n    //\n    const toolbarFactory = (0, apputils_1.createToolbarFactory)(toolbarRegistry, settingRegistry, 'Notebook', '@jupyterlab/notebook-extension:panel', translator);\n    // Duplicate notebook factory to apply it on Jupytext notebooks\n    // Mirror: https://github.com/jupyterlab/jupyterlab/blob/8a8c3752564f37493d4eb6b4c59008027fa83880/packages/notebook-extension/src/index.ts#L860\n    const factory = new notebook_1.NotebookWidgetFactory({\n        name: tokens_1.FACTORY,\n        label: trans.__(tokens_1.FACTORY),\n        fileTypes: allFileTypes,\n        modelName: (_a = notebookFactory.modelName) !== null && _a !== void 0 ? _a : 'notebook',\n        preferKernel: (_b = notebookFactory.preferKernel) !== null && _b !== void 0 ? _b : true,\n        canStartKernel: (_c = notebookFactory.canStartKernel) !== null && _c !== void 0 ? _c : true,\n        rendermime,\n        contentFactory,\n        editorConfig: notebookFactory.editorConfig,\n        notebookConfig: notebookFactory.notebookConfig,\n        mimeTypeService: editorServices.mimeTypeService,\n        toolbarFactory: toolbarFactory,\n        translator,\n    });\n    docRegistry.addWidgetFactory(factory);\n    // The list of extensions in the Jupytext Notebook factory.\n    const factoryExtensions = [];\n    const updateWidgetExtensions = () => {\n        // Dispose of all existing extensions.\n        factoryExtensions.forEach((extension) => extension.dispose());\n        // Add all the widgets extensions in the Notebook factory.\n        for (const extension of docRegistry.widgetExtensions('Notebook')) {\n            docRegistry.addWidgetExtension(tokens_1.FACTORY, extension);\n        }\n    };\n    // Listen for changes in Notebook factory extensions.\n    docRegistry.changed.connect((_, change) => {\n        if (change.type === 'widgetExtension' && change.name === 'Notebook') {\n            updateWidgetExtensions();\n        }\n    });\n    updateWidgetExtensions();\n    // Register widget created with the new factory in the notebook tracker\n    // This is required to activate notebook commands (and therefore shortcuts)\n    let id = 0; // The ID counter for notebook panels.\n    const ft = docRegistry.getFileType('notebook');\n    factory.widgetCreated.connect((sender, widget) => {\n        var _a, _b;\n        // If the notebook panel does not have an ID, assign it one.\n        widget.id = widget.id || `notebook-jupytext-${++id}`;\n        // Set up the title icon\n        widget.title.icon = ft === null || ft === void 0 ? void 0 : ft.icon;\n        widget.title.iconClass = (_a = ft === null || ft === void 0 ? void 0 : ft.iconClass) !== null && _a !== void 0 ? _a : '';\n        widget.title.iconLabel = (_b = ft === null || ft === void 0 ? void 0 : ft.iconLabel) !== null && _b !== void 0 ? _b : '';\n        // Notify the widget tracker if restore data needs to update.\n        widget.context.pathChanged.connect(() => {\n            // @ts-expect-error Trick using private API\n            void notebookTracker.save(widget);\n        });\n        // Add the notebook panel to the tracker.\n        //   @ts-expect-error Trick using private API\n        void notebookTracker.add(widget);\n    });\n    // Add support for RISE slides\n    if (riseFactory) {\n        for (const fileType of allFileTypes) {\n            riseFactory.addFileType(fileType);\n        }\n    }\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst apputils_1 = require(\"@jupyterlab/apputils\");\nconst docmanager_1 = require(\"@jupyterlab/docmanager\");\nconst codemirror_1 = require(\"@jupyterlab/codemirror\");\nconst launcher_1 = require(\"@jupyterlab/launcher\");\nconst settingregistry_1 = require(\"@jupyterlab/settingregistry\");\nconst codeeditor_1 = require(\"@jupyterlab/codeeditor\");\nconst notebook_1 = require(\"@jupyterlab/notebook\");\nconst rendermime_1 = require(\"@jupyterlab/rendermime\");\nconst filebrowser_1 = require(\"@jupyterlab/filebrowser\");\nconst mainmenu_1 = require(\"@jupyterlab/mainmenu\");\nconst translation_1 = require(\"@jupyterlab/translation\");\nconst ui_components_1 = require(\"@jupyterlab/ui-components\");\nconst disposable_1 = require(\"@lumino/disposable\");\nconst widgets_1 = require(\"@lumino/widgets\");\nconst coreutils_1 = require(\"@lumino/coreutils\");\nconst jupyterlab_rise_1 = require(\"jupyterlab-rise\");\nconst tokens_1 = require(\"./tokens\");\nconst commands_1 = require(\"./commands\");\nconst registry_1 = require(\"./registry\");\nconst factory_1 = require(\"./factory\");\nconst utils_1 = require(\"./utils\");\n/**\n * Initialization data for the jupyterlab-jupytext extension.\n */\nconst extension = {\n    id: tokens_1.JUPYTEXT_EXTENSION_ID,\n    autoStart: true,\n    optional: [\n        launcher_1.ILauncher,\n        mainmenu_1.IMainMenu,\n        filebrowser_1.IDefaultFileBrowser,\n        translation_1.ITranslator,\n        apputils_1.ICommandPalette,\n        jupyterlab_rise_1.IRisePreviewFactory,\n    ],\n    requires: [\n        notebook_1.NotebookPanel.IContentFactory,\n        codeeditor_1.IEditorServices,\n        docmanager_1.IDocumentManager,\n        codemirror_1.IEditorLanguageRegistry,\n        rendermime_1.IRenderMimeRegistry,\n        notebook_1.INotebookWidgetFactory,\n        notebook_1.INotebookTracker,\n        settingregistry_1.ISettingRegistry,\n        apputils_1.IToolbarWidgetRegistry,\n    ],\n    activate: async (app, contentFactory, editorServices, docManager, languages, rendermime, notebookFactory, notebookTracker, settingRegistry, toolbarRegistry, launcher, mainmenu, defaultBrowser, translator, palette, riseFactory) => {\n        console.log('JupyterLab extension jupytext is activating...');\n        const trans = (translator !== null && translator !== void 0 ? translator : translation_1.nullTranslator).load('jupytext');\n        // Load settings\n        const includeFormats = tokens_1.TEXT_NOTEBOOKS_LAUNCHER_ICONS;\n        if (settingRegistry) {\n            const settings = await settingRegistry.load(extension.id);\n            for (const format of tokens_1.JUPYTEXT_FORMATS) {\n                const addFormat = settings.get(format).composite;\n                if (addFormat && !includeFormats.includes(format)) {\n                    includeFormats.push(format);\n                }\n                else if (!addFormat && includeFormats.includes(format)) {\n                    includeFormats.splice(includeFormats.indexOf(format), 1);\n                }\n            }\n        }\n        // Unpack necessary components\n        const { commands, serviceManager, docRegistry } = app;\n        // Initialise Jupytext create notebook submenu and add it to File menu\n        const jupytextCreateMenu = new widgets_1.Menu({ commands: app.commands });\n        jupytextCreateMenu.id = 'jp-mainmenu-jupytext-new-menu';\n        jupytextCreateMenu.title.label = trans.__('New Text Notebook');\n        mainmenu.fileMenu.addItem({\n            rank: 0.97,\n            type: 'submenu',\n            submenu: jupytextCreateMenu,\n        });\n        // Add create text notebook submenu to context menu\n        // Rank 53 as 52 is used for classic notebook\n        // https://github.com/jupyterlab/jupyterlab/blob/4d34bbbea2afc7385169d92bf7bc0c9e0face3a9/packages/notebook-extension/schema/tracker.json#L363-L369\n        app.contextMenu.addItem({\n            submenu: jupytextCreateMenu,\n            type: 'submenu',\n            selector: '.jp-DirListing-content',\n            rank: 53,\n        });\n        // Initialise Jupytext menu and add it to main menu\n        const jupytextMenu = new widgets_1.Menu({ commands: app.commands });\n        mainmenu.fileMenu.addItem({\n            rank: 0.98,\n            type: 'submenu',\n            submenu: jupytextMenu,\n        });\n        jupytextMenu.id = 'jp-mainmenu-jupytext-menu';\n        jupytextMenu.title.label = trans.__('Jupytext');\n        // Get all Jupytext formats\n        let rank = 0;\n        const separatorIndex = [];\n        tokens_1.JUPYTEXT_PAIR_COMMANDS_FILETYPE_DATA.forEach((value, key) => {\n            value.map((fileType) => {\n                const format = key;\n                const command = `jupytext:pair-nb-with-${format}`;\n                commands.addCommand(command, {\n                    label: (args) => {\n                        var _a, _b;\n                        if (args.isPalette) {\n                            return ((_a = fileType.paletteLabel) !== null && _a !== void 0 ? _a : trans.__('Pair notebook'));\n                        }\n                        return (_b = fileType.caption) !== null && _b !== void 0 ? _b : trans.__('Pair notebook');\n                    },\n                    caption: trans.__(fileType.caption),\n                    icon: (args) => {\n                        if (args.isPalette) {\n                            return undefined;\n                        }\n                        else {\n                            return fileType.iconName\n                                ? ui_components_1.LabIcon.resolve({\n                                    icon: fileType.iconName,\n                                })\n                                : undefined;\n                        }\n                    },\n                    isToggled: () => {\n                        return (0, commands_1.isPairCommandToggled)(format, notebookTracker);\n                    },\n                    isEnabled: () => {\n                        return (0, commands_1.isPairCommandEnabled)(format, notebookTracker);\n                    },\n                    execute: () => {\n                        return (0, commands_1.executePairCommand)(command, format, notebookTracker, trans);\n                    },\n                });\n                console.debug('Registering pairing command=' + command + ' with rank=' + rank);\n                palette === null || palette === void 0 ? void 0 : palette.addItem({\n                    command,\n                    args: { isPalette: true },\n                    rank: rank + 1,\n                    category: 'Jupytext',\n                });\n                // Add to jupytext pair menu\n                jupytextMenu.addItem({\n                    command: command,\n                });\n                if (fileType.separator) {\n                    separatorIndex.push(rank);\n                }\n                rank += 1;\n            });\n        });\n        // Add separators in jupytext pair menu\n        separatorIndex.map((index, idx) => {\n            jupytextMenu.insertItem(index + idx + 1, {\n                type: 'separator',\n            });\n        });\n        // Metadata in text representation\n        commands.addCommand(tokens_1.CommandIDs.metadata, {\n            label: trans.__('Include Metadata'),\n            icon: (args) => {\n                if (args.isPalette) {\n                    return undefined;\n                }\n                else {\n                    return tokens_1.JupytextIcon;\n                }\n            },\n            isToggled: () => {\n                return (0, commands_1.isMetadataCommandToggled)(notebookTracker);\n            },\n            isEnabled: () => {\n                return (0, commands_1.isMetadataCommandEnabled)(notebookTracker);\n            },\n            execute: () => {\n                return (0, commands_1.executeMetadataCommand)(notebookTracker);\n            },\n        });\n        palette === null || palette === void 0 ? void 0 : palette.addItem({\n            command: tokens_1.CommandIDs.metadata,\n            args: { isPalette: true },\n            rank: 98,\n            category: 'Jupytext',\n        });\n        jupytextMenu.addItem({\n            type: 'separator',\n        });\n        jupytextMenu.addItem({\n            command: tokens_1.CommandIDs.metadata,\n        });\n        jupytextMenu.addItem({\n            type: 'separator',\n        });\n        // Register Jupytext FAQ command\n        commands.addCommand(tokens_1.CommandIDs.faq, {\n            label: trans.__('Jupytext FAQ'),\n            icon: (args) => {\n                if (args.isPalette) {\n                    return undefined;\n                }\n                else {\n                    return tokens_1.JupytextIcon;\n                }\n            },\n            execute: () => {\n                window.open('https://jupytext.readthedocs.io/en/latest/faq.html');\n            },\n        });\n        palette === null || palette === void 0 ? void 0 : palette.addItem({\n            command: tokens_1.CommandIDs.faq,\n            args: { isPalette: true },\n            rank: 99,\n            category: 'Jupytext',\n        });\n        jupytextMenu.addItem({\n            command: tokens_1.CommandIDs.faq,\n        });\n        // Register Jupytext Reference\n        commands.addCommand(tokens_1.CommandIDs.reference, {\n            label: trans.__('Jupytext Reference'),\n            icon: (args) => {\n                if (args.isPalette) {\n                    return undefined;\n                }\n                else {\n                    return tokens_1.JupytextIcon;\n                }\n            },\n            execute: () => {\n                window.open('https://jupytext.readthedocs.io/en/latest/');\n            },\n        });\n        palette === null || palette === void 0 ? void 0 : palette.addItem({\n            command: tokens_1.CommandIDs.reference,\n            args: { isPalette: true },\n            rank: 100,\n            category: 'Jupytext',\n        });\n        jupytextMenu.addItem({\n            command: tokens_1.CommandIDs.reference,\n        });\n        // Register a new command to create untitled file. This snippet is taken\n        // from docManager package https://github.com/jupyterlab/jupyterlab/blob/c106f0a19110efad7c5e1b136144985819e21100/packages/docmanager-extension/src/index.tsx#L679-L680\n        // We are \"duplicating\" it as base command adds extension to the options\n        // only if it is of type file. But we are interested in creating notebook type\n        // files with different Jupytext supported extensions. So we create a dedicated\n        // create new text notebook command here and make sure we pass extension in options\n        commands.addCommand(tokens_1.CommandIDs.newUntitled, {\n            execute: async (args) => {\n                const errorTitle = args['error'] || trans.__('Error');\n                const path = typeof args['path'] === 'undefined' ? '' : args['path'];\n                const options = {\n                    type: args['type'],\n                    path,\n                };\n                // Ensure we pass extension to command always\n                options.ext = args['ext'] || '.txt';\n                return docManager.services.contents\n                    .newUntitled(options)\n                    .catch((error) => (0, apputils_1.showErrorMessage)(errorTitle, error));\n            },\n            label: (args) => args['label'] || `New ${args['type']}`,\n        });\n        // We dont need to add this command to palettte as it is a utility one\n        // which does not have direct usage\n        // palette?.addItem({\n        //   command: CommandIDs.newUntitled,\n        //   rank: 50,\n        //   category: 'Jupytext',\n        // });\n        // Get a map of available kernel languages in current widget\n        const availableKernelLanguages = await (0, utils_1.getAvailableKernelLanguages)(languages, serviceManager);\n        // Get a map of all create text notebook commands\n        const createTextNotebookCommands = await (0, utils_1.getAvailableCreateTextNotebookCommands)(includeFormats, availableKernelLanguages);\n        // Register Jupytext text notebooks file types\n        (0, registry_1.registerFileTypes)(availableKernelLanguages, docRegistry, trans);\n        // Get all kernel file types to add to Jupytext factory\n        const kernelLanguageNames = [];\n        for (const kernelLanguage of availableKernelLanguages.keys()) {\n            kernelLanguageNames.push(kernelLanguage);\n        }\n        // Create a factory for Jupytext\n        (0, factory_1.createFactory)(kernelLanguageNames, toolbarRegistry, settingRegistry, docRegistry, notebookTracker, notebookFactory, contentFactory, editorServices, rendermime, translator, trans, riseFactory);\n        // Register all the commands that create text notebooks with different formats\n        // Nicked from notebook-extension package in JupyterLab\n        // https://github.com/jupyterlab/jupyterlab/blob/c106f0a19110efad7c5e1b136144985819e21100/packages/notebook-extension/src/index.ts#L1902-L1965\n        createTextNotebookCommands.forEach((fileTypes, _) => {\n            fileTypes.map((fileType) => {\n                const format = fileType.fileExt;\n                const command = `jupytext:create-new-text-notebook-${format}`;\n                const iconName = fileType.iconName;\n                const kernelIcon = fileType.kernelIcon;\n                commands.addCommand(command, {\n                    label: (args) => {\n                        if (args['isLauncher']) {\n                            return trans.__(fileType.launcherLabel);\n                        }\n                        return trans.__(fileType.paletteLabel);\n                    },\n                    caption: trans.__(fileType.caption),\n                    icon: (args) => {\n                        if (args.isPalette) {\n                            return undefined;\n                        }\n                        else {\n                            if (iconName) {\n                                return ui_components_1.LabIcon.resolve({\n                                    icon: iconName,\n                                });\n                            }\n                            if (kernelIcon) {\n                                return kernelIcon;\n                            }\n                            return ui_components_1.LabIcon.resolve({\n                                icon: 'ui-components:kernel',\n                            });\n                        }\n                    },\n                    execute: (args) => {\n                        var _a;\n                        const cwd = args['cwd'] || ((_a = defaultBrowser === null || defaultBrowser === void 0 ? void 0 : defaultBrowser.model.path) !== null && _a !== void 0 ? _a : '');\n                        const kernelId = args['kernelId'] || '';\n                        const kernelName = args['kernelName'] || '';\n                        return (0, utils_1.createNewTextNotebook)(cwd, kernelId, kernelName, format, commands);\n                    },\n                });\n                console.debug('Registering create new text notebook command=' +\n                    command +\n                    ' with rank=' +\n                    rank);\n                palette === null || palette === void 0 ? void 0 : palette.addItem({\n                    command,\n                    args: { isPalette: true },\n                    rank: rank,\n                    category: 'Jupytext',\n                });\n                if (includeFormats.includes(format)) {\n                    jupytextCreateMenu.addItem({\n                        command: command,\n                        args: { isMainMenu: true },\n                    });\n                    // Add separator after each kernel type\n                    if (fileType.separator) {\n                        jupytextCreateMenu.addItem({\n                            type: 'separator',\n                        });\n                    }\n                }\n                // Add a launcher item if the launcher is available.\n                if (launcher && includeFormats.includes(format)) {\n                    void serviceManager.ready.then(() => {\n                        let disposables = null;\n                        const onSpecsChanged = () => {\n                            var _a, _b, _c;\n                            if (disposables) {\n                                disposables.dispose();\n                                disposables = null;\n                            }\n                            const specs = serviceManager.kernelspecs.specs;\n                            if (!specs) {\n                                return;\n                            }\n                            disposables = new disposable_1.DisposableSet();\n                            const kernelIconUrl = ((_a = specs.kernelspecs[fileType.kernelName]) === null || _a === void 0 ? void 0 : _a.resources['logo-svg']) ||\n                                ((_b = specs.kernelspecs[fileType.kernelName]) === null || _b === void 0 ? void 0 : _b.resources['logo-64x64']);\n                            disposables.add(launcher.add({\n                                command: command,\n                                args: { isLauncher: true, kernelName: fileType.kernelName },\n                                category: trans.__('Jupytext'),\n                                rank: rank++,\n                                kernelIconUrl,\n                                metadata: {\n                                    kernel: coreutils_1.JSONExt.deepCopy(((_c = specs.kernelspecs[fileType.kernelName]) === null || _c === void 0 ? void 0 : _c.metadata) || {}),\n                                },\n                            }));\n                        };\n                        onSpecsChanged();\n                        serviceManager.kernelspecs.specsChanged.connect(onSpecsChanged);\n                    });\n                }\n                // Increment rank\n                rank += 1;\n            });\n        });\n    },\n};\nexports.default = extension;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.registerFileTypes = registerFileTypes;\nconst ui_components_1 = require(\"@jupyterlab/ui-components\");\nfunction registerFileTypes(availableKernelLanguages, docRegistry, trans) {\n    // Add kernel file types to registry\n    availableKernelLanguages.forEach((kernelFileTypes, kernelLanguage) => {\n        // Do not add python as it will be already there by default\n        if (kernelLanguage !== 'python') {\n            kernelFileTypes.map((kernelFileType) => {\n                docRegistry.addFileType({\n                    name: kernelLanguage,\n                    contentType: 'file',\n                    displayName: trans.__(kernelFileType.paletteLabel.split('New')[1].trim()),\n                    extensions: [`.${kernelFileType.fileExt}`],\n                    icon: kernelFileType.kernelIcon || ui_components_1.kernelIcon,\n                });\n            });\n        }\n    });\n    // Add markdown file types to registry\n    docRegistry.addFileType({\n        name: 'myst',\n        contentType: 'notebook',\n        displayName: trans.__('MyST Markdown Notebook'),\n        extensions: ['.myst', '.mystnb', '.mnb'],\n        icon: ui_components_1.markdownIcon,\n    }, ['Notebook']);\n    docRegistry.addFileType({\n        name: 'r-markdown',\n        contentType: 'notebook',\n        displayName: trans.__('R Markdown Notebook'),\n        // Extension file are transformed to lower case...\n        extensions: ['.Rmd'],\n        icon: ui_components_1.markdownIcon,\n    }, ['Notebook']);\n    docRegistry.addFileType({\n        name: 'quarto',\n        contentType: 'notebook',\n        displayName: trans.__('Quarto Notebook'),\n        extensions: ['.qmd'],\n        icon: ui_components_1.markdownIcon,\n    }, ['Notebook']);\n}\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TEXT_NOTEBOOKS_LAUNCHER_ICONS = exports.JUPYTEXT_FORMATS = exports.JUPYTEXT_CREATE_TEXT_NOTEBOOK_FILETYPE_DATA = exports.AUTO_LANGUAGE_FILETYPE_DATA = exports.JUPYTEXT_PAIR_COMMANDS_FILETYPE_DATA = exports.SERVER_SETTINGS = exports.JupytextIcon = exports.CommandIDs = exports.NS = exports.FILE_TYPES = exports.LANGUAGE_INDEPENDENT_NOTEBOOK_EXTENSIONS = exports.FACTORY = exports.JUPYTEXT_EXTENSION_ID = void 0;\nconst services_1 = require(\"@jupyterlab/services\");\nconst ui_components_1 = require(\"@jupyterlab/ui-components\");\nconst logo_svg_1 = __importDefault(require(\"../style/icons/logo.svg\"));\n/**\n * Jupytext extension ID\n */\nexports.JUPYTEXT_EXTENSION_ID = 'jupyterlab-jupytext:plugin';\n/**\n * Jupytext widget factory\n */\nexports.FACTORY = 'Jupytext Notebook';\n/**\n * Supported file formats.\n */\nexports.LANGUAGE_INDEPENDENT_NOTEBOOK_EXTENSIONS = [\n    'ipynb',\n    'md',\n    'Rmd',\n    'qmd',\n];\n/**\n * Supported file types names.\n */\nexports.FILE_TYPES = [\n    'markdown',\n    'myst',\n    'r-markdown',\n    'quarto',\n    'julia',\n    'python',\n    'r',\n];\n/**\n * The short namespace for commands, etc.\n */\nexports.NS = 'jupytext';\n/**\n * Command IDs of Jupytext\n */\nvar CommandIDs;\n(function (CommandIDs) {\n    CommandIDs.metadata = `${exports.NS}:metadata`;\n    CommandIDs.reference = `${exports.NS}:reference`;\n    CommandIDs.faq = `${exports.NS}:faq`;\n    CommandIDs.newUntitled = `${exports.NS}:new-untitled-text-notebook`;\n})(CommandIDs || (exports.CommandIDs = CommandIDs = {}));\n/**\n * Jupytext logo icon\n */\nexports.JupytextIcon = new ui_components_1.LabIcon({\n    name: `${exports.NS}:icon:logo`,\n    svgstr: logo_svg_1.default,\n});\n/**\n * Current Jupyter server settings\n */\nexports.SERVER_SETTINGS = services_1.ServerConnection.makeSettings();\n/**\n * Supported Jupytext pairings along with metadata.\n */\nexports.JUPYTEXT_PAIR_COMMANDS_FILETYPE_DATA = new Map([\n    [\n        'ipynb',\n        [\n            {\n                fileExt: 'ipynb',\n                paletteLabel: 'Pair with ipynb',\n                caption: 'Pair Notebook with ipynb document',\n                iconName: 'ui-components:notebook',\n                separator: true,\n            },\n        ],\n    ],\n    [\n        'auto:percent',\n        [\n            {\n                fileExt: 'auto:percent',\n                paletteLabel: 'Pair with percent script',\n                caption: 'Pair Notebook with Percent Format',\n                iconName: 'ui-components:text-editor',\n            },\n        ],\n    ],\n    [\n        'auto:light',\n        [\n            {\n                fileExt: 'auto:light',\n                paletteLabel: 'Pair with light script',\n                caption: 'Pair Notebook with Light Format',\n                iconName: 'ui-components:text-editor',\n            },\n        ],\n    ],\n    [\n        'auto:nomarker',\n        [\n            {\n                fileExt: 'auto:nomarker',\n                paletteLabel: 'Pair with nomarker script',\n                caption: 'Pair Notebook with Nomarker Format',\n                iconName: 'ui-components:text-editor',\n                separator: true,\n            },\n        ],\n    ],\n    [\n        'py:marimo',\n        [\n            {\n                fileExt: 'py:marimo',\n                paletteLabel: 'Pair with Marimo Python script',\n                caption: 'Pair Notebook with Marimo Python script',\n                iconName: 'ui-components:text-editor',\n                separator: true,\n            },\n        ],\n    ],\n    [\n        'md',\n        [\n            {\n                fileExt: 'md',\n                paletteLabel: 'Pair with md',\n                caption: 'Pair Notebook with Markdown',\n                iconName: 'ui-components:markdown',\n            },\n        ],\n    ],\n    [\n        'md:myst',\n        [\n            {\n                fileExt: 'md:myst',\n                paletteLabel: 'Pair with myst md',\n                caption: 'Pair Notebook with MyST Markdown',\n                iconName: 'ui-components:markdown',\n                separator: true,\n            },\n        ],\n    ],\n    [\n        'Rmd',\n        [\n            {\n                fileExt: 'Rmd',\n                paletteLabel: 'Pair with Rmd',\n                caption: 'Pair Notebook with R Markdown',\n                iconName: 'ui-components:markdown',\n            },\n        ],\n    ],\n    [\n        'qmd',\n        [\n            {\n                fileExt: 'qmd',\n                paletteLabel: 'Pair with qmd',\n                caption: 'Pair Notebook with Quarto (qmd)',\n                iconName: 'ui-components:markdown',\n                separator: true,\n            },\n        ],\n    ],\n    [\n        'custom',\n        [\n            {\n                fileExt: 'custom',\n                paletteLabel: 'Custom pair',\n                caption: 'Custom Pairing',\n                iconName: 'ui-components:text-editor',\n            },\n        ],\n    ],\n    [\n        'none',\n        [\n            {\n                fileExt: 'none',\n                paletteLabel: 'Unpair',\n                caption: 'Unpair Current Notebook',\n            },\n        ],\n    ],\n]);\n/**\n * Supported kernels file types metadata\n */\nexports.AUTO_LANGUAGE_FILETYPE_DATA = new Map([\n    [\n        'python',\n        [\n            {\n                fileExt: 'py',\n                paletteLabel: 'New Python Text Notebook',\n                caption: 'Create a new Python Text Notebook',\n                iconName: 'ui-components:python',\n                launcherLabel: 'Python',\n                kernelName: 'python3',\n            },\n        ],\n    ],\n    [\n        'julia',\n        [\n            {\n                fileExt: 'jl',\n                paletteLabel: 'New Julia Text Notebook',\n                caption: 'Create a new Julia Text Notebook',\n                iconName: 'ui-components:julia',\n                launcherLabel: 'Julia',\n                kernelName: 'julia',\n            },\n        ],\n    ],\n    [\n        'R',\n        [\n            {\n                fileExt: 'R',\n                paletteLabel: 'New R Text Notebook',\n                caption: 'Create a new R Text Notebook',\n                iconName: 'ui-components:r-kernel',\n                launcherLabel: 'R',\n                kernelName: 'ir',\n            },\n        ],\n    ],\n]);\n/**\n * Supported Jupytext create new text notebooks file types\n */\nexports.JUPYTEXT_CREATE_TEXT_NOTEBOOK_FILETYPE_DATA = new Map([\n    [\n        'auto:percent',\n        [\n            {\n                fileExt: 'auto:percent',\n                paletteLabel: 'Percent Format',\n                caption: 'Percent Format',\n                launcherLabel: 'Percent Format',\n            },\n        ],\n    ],\n    [\n        'auto:light',\n        [\n            {\n                fileExt: 'auto:light',\n                paletteLabel: 'Light Format',\n                caption: 'Light Format',\n                launcherLabel: 'Light Format',\n            },\n        ],\n    ],\n    [\n        'auto:nomarker',\n        [\n            {\n                fileExt: 'auto:nomarker',\n                paletteLabel: 'Nomarker Format',\n                caption: 'Nomarker Format',\n                launcherLabel: 'Nomarker Format',\n            },\n        ],\n    ],\n    [\n        'py:marimo',\n        [\n            {\n                fileExt: 'py:marimo',\n                paletteLabel: 'Marimo Format',\n                caption: 'Marimo Format',\n                launcherLabel: 'Marimo Format',\n            },\n        ],\n    ],\n    [\n        'md',\n        [\n            {\n                fileExt: 'md',\n                paletteLabel: 'New Markdown Text Notebook',\n                caption: 'Create a new Markdown Text Notebook',\n                iconName: 'ui-components:markdown',\n                launcherLabel: 'Markdown',\n            },\n        ],\n    ],\n    [\n        'md:myst',\n        [\n            {\n                fileExt: 'md:myst',\n                paletteLabel: 'New MyST Markdown Text Notebook',\n                caption: 'Create a new MyST Markdown Text Notebook',\n                iconName: 'ui-components:markdown',\n                launcherLabel: 'MyST Markdown',\n            },\n        ],\n    ],\n    [\n        'Rmd',\n        [\n            {\n                fileExt: 'Rmd',\n                paletteLabel: 'New R Markdown Text Notebook',\n                caption: 'Create a new R Markdown Text Notebook',\n                iconName: 'ui-components:markdown',\n                launcherLabel: 'R Markdown',\n            },\n        ],\n    ],\n    [\n        'qmd',\n        [\n            {\n                fileExt: 'qmd',\n                paletteLabel: 'New Quarto Markdown Text Notebook',\n                caption: 'Create a new Quarto Markdown Text Notebook',\n                iconName: 'ui-components:markdown',\n                launcherLabel: 'Quarto Markdown',\n            },\n        ],\n    ],\n]);\n/**\n * Supported Jupytext format extensions bar custom and none\n */\nexports.JUPYTEXT_FORMATS = Array.from(exports.JUPYTEXT_PAIR_COMMANDS_FILETYPE_DATA.keys())\n    .map((format) => {\n    return format;\n})\n    .filter((format) => {\n    return !['custom', 'none'].includes(format);\n});\n/**\n * List of formats that would be added to launcher icons\n */\nexports.TEXT_NOTEBOOKS_LAUNCHER_ICONS = exports.JUPYTEXT_FORMATS.filter((format) => {\n    return !['ipynb', 'auto:nomarker', 'qmd', 'custom', 'none'].includes(format);\n});\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createNewTextNotebook = void 0;\nexports.getAvailableKernelLanguages = getAvailableKernelLanguages;\nexports.getAvailableCreateTextNotebookCommands = getAvailableCreateTextNotebookCommands;\nconst services_1 = require(\"@jupyterlab/services\");\nconst ui_components_1 = require(\"@jupyterlab/ui-components\");\nconst coreutils_1 = require(\"@jupyterlab/coreutils\");\nconst buffer_1 = require(\"buffer\");\nconst tokens_1 = require(\"./tokens\");\n/**\n * Get kernel icon SVG string\n */\nasync function getKernelIconBase64String(kernelIconUrl) {\n    // Seems like URL prefix is already included in kernelIconUrl. We need to strip\n    // it off as baseUrl will already has url prefix.\n    kernelIconUrl = `/kernelspecs${kernelIconUrl.split('kernelspecs')[1]}`;\n    const url = coreutils_1.URLExt.join(tokens_1.SERVER_SETTINGS.baseUrl, kernelIconUrl);\n    const response = await services_1.ServerConnection.makeRequest(url, {}, tokens_1.SERVER_SETTINGS);\n    const blob = await response.arrayBuffer();\n    const contentType = response.headers.get('content-type');\n    return `data:${contentType};base64,${buffer_1.Buffer.from(blob).toString('base64')}`;\n}\n/**\n * Make a SVG string from base64 image\n */\nfunction base64ToSvgStr(width, imageBase64) {\n    return `<svg xmlns=\"http://www.w3.org/2000/svg\"\n  xmlns:xlink=\"http://www.w3.org/1999/xlink\" preserveAspectRatio=\"none\" viewBox=\"0 0 ${width} ${width}\">\n  <g id=\"layer1\">\n     <image xlink:href=\"${imageBase64}\"/>\n  </g>\n</svg>`.replace(/\\n/g, ' ');\n}\n/**\n * Get kernel Icon\n */\nasync function getKernelIcon(specModel) {\n    // First check for logo-svg\n    if (specModel.resources['logo-svg']) {\n        const svgStr = await getKernelIconBase64String(specModel.resources['logo-svg']);\n        return new ui_components_1.LabIcon({\n            name: `${tokens_1.NS}:icon:${specModel.name}`,\n            svgstr: svgStr,\n        });\n    }\n    // Else check if 64x64 kernel icon is available\n    if (specModel.resources['logo-64x64']) {\n        const iconBase64String = await getKernelIconBase64String(specModel.resources['logo-64x64']);\n        return new ui_components_1.LabIcon({\n            name: `${tokens_1.NS}:icon:${specModel.name}`,\n            svgstr: base64ToSvgStr(64, iconBase64String),\n        });\n    }\n    // Finally check for 32x32 kernel icon\n    if (specModel.resources['logo-32x32']) {\n        const iconBase64String = await getKernelIconBase64String(specModel.resources['logo-32x32']);\n        return new ui_components_1.LabIcon({\n            name: `${tokens_1.NS}:icon:${specModel.name}`,\n            svgstr: base64ToSvgStr(32, iconBase64String),\n        });\n    }\n    // If not found, make a generic kernel icon\n    return ui_components_1.LabIcon.resolve({\n        icon: 'ui-components:kernel',\n    });\n}\n/**\n * Get all available kernel languages so that we replace auto format\n * with these language file extensions\n */\nasync function getAvailableKernelLanguages(languages, serviceManager) {\n    var _a, _b;\n    const specsManager = serviceManager.kernelspecs;\n    await specsManager.ready;\n    const fileTypes = new Map();\n    const specs = (_b = (_a = specsManager.specs) === null || _a === void 0 ? void 0 : _a.kernelspecs) !== null && _b !== void 0 ? _b : {};\n    for (const [spec, specModel] of Object.entries(specs)) {\n        if (specModel) {\n            // First check if kernel is one of the pre-defined types (Python, R, Julia)\n            const exts = tokens_1.AUTO_LANGUAGE_FILETYPE_DATA.get(specModel.language);\n            if (exts !== undefined) {\n                fileTypes.set(specModel.language, exts);\n            }\n            else {\n                // If not, try to get languageInfo from codemirror languages\n                const languageInfo = languages.findByName(specModel.language);\n                // If we managed to find the language, construct the FileTypeData\n                // Here we make an assumption that first extension in\n                // languageInfo.extensions is the most common one.\n                if (languageInfo) {\n                    // We attempt to get kernelIcon here for specModel.resources\n                    // If none provided, we return generic kernel icon\n                    const kernelIcon = await getKernelIcon(specModel);\n                    const displayName = languageInfo.displayName || specModel.display_name;\n                    const exts = [\n                        {\n                            fileExt: languageInfo.extensions[0],\n                            paletteLabel: `New ${displayName} Text Notebook`,\n                            caption: `Create a new ${displayName} Text Notebook`,\n                            kernelIcon: kernelIcon,\n                            launcherLabel: displayName,\n                            kernelName: spec,\n                        },\n                    ];\n                    fileTypes.set(specModel.language, exts);\n                }\n            }\n        }\n    }\n    return fileTypes;\n}\n/**\n * Get all available 'Create New Text Notebook' commands based on configured\n * formats and available kernels\n */\nasync function getAvailableCreateTextNotebookCommands(includeFormats, availableKernelLanguages) {\n    const numKernels = availableKernelLanguages.size;\n    // Initialise a map of 'Create New Text Notebook' command filetypes\n    const createTextNotebookCommands = new Map();\n    // Iterate through all JUPYTEXT_CREATE_TEXT_NOTEBOOK_FILETYPE_DATA file types.\n    tokens_1.JUPYTEXT_CREATE_TEXT_NOTEBOOK_FILETYPE_DATA.forEach((fileTypes, format) => {\n        fileTypes.map((fileType) => {\n            // If format is auto, we need to add all currently available kernels\n            // For instance if there are Python and R kernels available, format\n            // auto:percent will be replaced by py:percent and R:percent\n            if (format.startsWith('auto')) {\n                const formatType = format.split(':')[1];\n                let mapIndex = 0;\n                availableKernelLanguages.forEach((kernelLanguages, kernelKey) => {\n                    const updatedKernelKey = `${kernelKey}:${formatType}`;\n                    createTextNotebookCommands.set(updatedKernelKey, []);\n                    mapIndex += 1;\n                    kernelLanguages.map((kernelLanguageFileType) => {\n                        // Merge fileType object from kernel and Jupytext format and push\n                        // it to createTextNotebookCommands\n                        const updatedKernelLanguageFileType = {\n                            ...kernelLanguageFileType,\n                        };\n                        updatedKernelLanguageFileType.fileExt = `${updatedKernelLanguageFileType.fileExt}:${formatType}`;\n                        updatedKernelLanguageFileType.paletteLabel = `${updatedKernelLanguageFileType.paletteLabel} with ${fileType.paletteLabel}`;\n                        updatedKernelLanguageFileType.caption = `${updatedKernelLanguageFileType.caption} with ${fileType.caption}`;\n                        updatedKernelLanguageFileType.launcherLabel = `${updatedKernelLanguageFileType.launcherLabel} - ${fileType.launcherLabel}`;\n                        if (numKernels === mapIndex) {\n                            updatedKernelLanguageFileType.separator = true;\n                        }\n                        createTextNotebookCommands\n                            .get(updatedKernelKey)\n                            .push(updatedKernelLanguageFileType);\n                        // Update includeFormats with the language specific formats\n                        // Effectiviely we will add formats like py:light, js:light here\n                        if (includeFormats.includes(format)) {\n                            includeFormats.push(updatedKernelLanguageFileType.fileExt);\n                        }\n                    });\n                });\n            }\n            else {\n                if (createTextNotebookCommands.get(format) === undefined) {\n                    createTextNotebookCommands.set(format, []);\n                }\n                createTextNotebookCommands.get(format).push(fileType);\n            }\n        });\n    });\n    return createTextNotebookCommands;\n}\n/**\n * Create New Text Notebook file\n */\nconst createNewTextNotebook = async (cwd, kernelId, kernelName, format, commands) => {\n    const model = await commands.execute(tokens_1.CommandIDs.newUntitled, {\n        path: cwd,\n        type: 'notebook',\n        // We should not have auto in format at this point. If somehow we end up having\n        // it, ensure we replace by py as Python kernel exists always\n        ext: format.replace('auto', 'py'),\n    });\n    if (model !== undefined) {\n        const widget = (await commands.execute('docmanager:open', {\n            path: model.path,\n            factory: tokens_1.FACTORY,\n            kernel: { id: kernelId, name: kernelName },\n        }));\n        widget.isUntitled = true;\n        return widget;\n    }\n};\nexports.createNewTextNotebook = createNewTextNotebook;\n"],"names":[],"ignoreList":[],"sourceRoot":""}